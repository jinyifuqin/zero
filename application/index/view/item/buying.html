<!DOCTYPE html>
<html>

	<head>
		<meta charset="UTF-8">
		<meta name="robots" content="index,follow" />
		<meta name="viewport" content="width=device-width, initial-scale=1.0" />
		<meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
		<meta http-equiv="X-UA-Compatible" content="IE=10" />
		<title>提交订单3</title>
		<link href="/public/indexsource/css/css1.css" type="text/css" rel="stylesheet">
		<script type="text/javascript" src="/public/indexsource/js/jquery-1.9.1.min.js"></script>
		<script type="text/javascript" src="/public/indexsource/js/superslide.2.1.js"></script>
		<script type="text/javascript" src="/public/indexsource/js/iscroll.js"></script>
		<script type="text/javascript" src="/public/indexsource/address/js/jquery.min.js"></script>
		<script type="text/javascript" src="/public/admins/lib/layer/twofour/layer.js"></script>
		<link href="/public/indexsource/css/css1.css" type="text/css" rel="stylesheet">
		<link href="/public/indexsource/css/css2.css" type="text/css" rel="stylesheet">
		<link href="/public/indexsource/css/css_yan.css" type="text/css" rel="stylesheet">
		<script src="/public/indexsource/js/pic.js"></script>
	</head>
<style type="text/css">
	.fan{background: #fff;}
	.fan i{font-style: normal;    font-size: 1.2rem;
		margin-left: 4%;
		display: inline-block;
		float: left;
		line-height: 4rem;
		font-weight: 400;
		font-family: "microsoft yahei";height: 4rem;}
	.fan input{height: 1.5rem; line-height: 1.5rem;width: 50%;margin-top: 1.2rem;margin-left: 5%;}
	.buynum{
		background: transparent;
		outline: none;
		border: none;width: 90%;
		overflow: hidden;font-size: 12px;

	}
	.drop{
		line-height: 4rem;
		background: transparent;
		margin-top: 1.5rem;
		height: 4rem;
		margin-bottom: 6rem;
	}
</style>
	<body class="bjhs1">
	<div class="APPtop user_top">
		<a href="/item/{$data.item.id}"><img class="fh" src="/public/indexsource/images/fh.png" alt=""/></a>
		<p class="page">永之泰俱乐部</p>
		<!--<img class="applogo" src="images/applogo.png" alt="" />-->
		<img class="shouse" src="/public/indexsource/images/shouse.png" alt="" />
	</div>
	<div class="rbj"></div>
	<ul class="menuS">
		<a href="index.html"><p>首页</p></a>
		<a href="#"><p>商城</p></a>
		<a href="#"><p>社区</p></a>
		<a href="#"><p>分享</p></a>
		<a href="#"><p>会员中心</p></a>
	</ul>


		<form method="post" action="/tradeCreate">


		<div class="big_qb11" style="overflow: hidden;">
			<div class="shdz">
				{if condition="(!array_key_exists('addr',$data))"}
				<div class="tjddb1">
					<a href="/addAddr">
						<span>您还没有收货地址，</span>
						<font>点击新建</font>
						<div class="tjddb2"></div>
						<div class="huise"></div>
					</a>
				</div>
				{else/}
				<a href="/addAddr">
					<div class="shdz1">
						<font>{$data.addr.name}</font><span>{$data.addr.phone_num}</span></div>
					<img src="/public/indexsource/images/jian1.jpg" class="jiantou" />
					<div class="shdz2">
						<span>地址：{$data.addr.desc} {$data.addr.detail_desc}</span>
					</div>
					<div class="shdz3"></div>
					<input type="hidden" name="name" value="{$data.addr.name}">
					<input type="hidden" name="address" value="{$data.addr.desc} {$data.addr.detail_desc}">
					<input type="hidden" name="phone_num" value="{$data.addr.phone_num}">
				</a>
				{/if}
			</div>
			<div class="yidakuai">
				<div class="tjddb3">
					<div class="tjddb31">
						<h3>品牌：{$data.item.brandName} </h3>
						<input type="hidden" name="itemid" value="{$data.item.id}">
						<!--<input id="inpB" type="hidden" name="buynum" value="">-->
						<input id="inpP" type="hidden" name="totalprice" value="{$data.item.price}">
					</div>
					<div class="tjddb32">
						<dl>
							<dt><img src="/public/uploads/{$data.item.pic}"/></dt>
							<dd class="tjddb34">
								<h4>{$data.item.name}</h4><span>x1</span></dd>
							<dd class="tjddb35">
								<b>¥{$data.item.price}</b>
								<div class="tjddb33">
									<ul>
										<li style="vertical-align: middle;font-size: 1.2rem;background: transparent;outline: none;width: 2rem;" class="tjddb36 plus"> +</li>
										<li class="tjddb37 num" style="width: 2rem;">
											<input style="width:100%; text-align: center;vertical-align: top;padding: 3%;" id="inpB" type="number" value="1" placeholder="1" name="buynum" class="buynum inputNum"/>
										</li>
										<li style="vertical-align: middle;font-size: 1.2rem;vertical-align:middle;background: transparent;outline: none;width: 2rem" class="tjddb38 reduce">-</li>
									</ul>
								</div>
							</dd>
							<div class="cl"></div>
						</dl>
					</div>

				</div>
			</div>
			<div class="oneprice" style="display: none;" oneprice="{$data.item.price}"></div>
			<div class="fan">
				<a href="#">
					<i>优惠券</i><input id="discount" name="discount" type="text" placeholder="请输入优惠券号码" />
				</a>
			</div>
			<div class="tjddb40">
				<span>共1件商品 </span>
				<font>小计：</font><b>¥{$data.item.price}</b>
			</div>
			<div class="jifen5" style="background: gainsboro">
				<div class="jifen5_1">
					<span>订单创建成功，请向<i style="display: inline">服务中心<b></b></i>付款，并等待发货</span>
					<span></span>
				</div>
				<div>
					<button type="button" class="button1"><a href="#">确定</a></button>
					<!--<button type="button" class="button2"><a href="#">取消</a></button>-->
				</div>
			</div>

			<div class="tjddb43">
				<div class="tjddb44">
					<font>共<i>1</i>件</font><span>合计支付：</span><b>¥{$data.item.price}</b>
				</div>
				<div class="tjddb45">
					<a href="#" id="sub">提交订单</a>
				</div>
			</div>
		</div>
		</form>
	<script>
		function set(num,oneAllPrice){
		    oneAllPrice = Math.round(oneAllPrice*100)/100;
            var numtag = $('.tjddb44 font');
            var numtag1 = $('.tjddb40 span');
            var numtag2 = $('.tjddb34 span');
            var smallTotal = $('.tjddb40 b');
            var smallTotal1 = $('.tjddb35 b');
            var allTotal = $('.tjddb44 b');
            $('.inputNum').val(num);
            numtag.html("共<i>"+num+"</i>件");
            numtag1.html("共"+num+"件商品");
            numtag2.html("x"+num);
            smallTotal.html("¥"+oneAllPrice);
            smallTotal1.html("¥"+oneAllPrice);
            allTotal.html("¥"+oneAllPrice);
            $('#inpB').val(num);
            $('#inpP').val(oneAllPrice);
		}

		$(function(){
			var top = $('.APPtop');
            var height = top.outerHeight();
            var addr = $('.big_qb11');
            addr.css('padding-top',height);
            var num = $('.inputNum').val();
            var onePrice = $('.oneprice').attr('oneprice');
            var changeFlag = false;
            var oldOnePrice = 0;
            $('#discount').change(function(){
                var disNum = $(this).val();
                var data = {'discountNum':disNum};
                $.ajax({
                    type: "GET",
                    url: '/item/checkDiscount',
                    data: data,
                    dataType: "json",
                    success: function(result){
                        // console.log(result);
                        if(result.type == 'success'){
                            layer.msg('优惠券使用成功！',{icon:1,time:2000});
                            oldOnePrice = onePrice;
                            onePrice = onePrice*0.1*result.zk;
                            oneAllPrice = num*onePrice;
                            changeFlag = true;
                            set(num,oneAllPrice);
						}else{
                            layer.msg('优惠券无效，或者次数已尽！',{icon:0,time:2000});
                            if(changeFlag){
                                onePrice = oldOnePrice;
                                oneAllPrice = num*onePrice;
                                changeFlag = false;
                                set(num,oneAllPrice);
							}
						}

                    }
                });

			})
            $('.inputNum').blur(function(){
                var reg = /^[1-9][0-9]*$/;
                num = $(this).val();
                console.log(num);
                var check = reg.test(num);
                if(!check){
                    $('.inputNum').val(1);
                    set(1,1*onePrice);
                    layer.msg('请填写正确的数量!',{icon:2,time:1000});
                    return false;
				}
                var oneAllPrice = onePrice*num;
				set(num,oneAllPrice);
			});
            $('.plus').click(function(){
                var reg = /^[1-9][1-9]*$/;
                var check = reg.test(num);
                if(!check){
					return false;
				}
                num = parseInt(num)+1;
                var oneAllPrice = onePrice*num;
                set(num,oneAllPrice);
			});
            $('.reduce').click(function(){
                var reg = /^[1-9][1-9]*$/;
                var check = reg.test(num);
                if(!check){
                    return false;
                }
                if(parseInt(num)>1)
                num = parseInt(num)-1;
                var oneAllPrice = onePrice*num;
                set(num,oneAllPrice);
            });

            $('#sub').click(function(e){
                e.preventDefault();
                var flag = "<?php echo $data['flag'] ?>";
                if(flag == 'error'){
                    alert_choose_service('选择服务中心','/choose_service_cent','10001');
                    return;
				}
				// console.log(flag);return;

				var url = $('form').attr('action');
				var data = $('form').serialize();
                $.ajax({
                    type: "POST",
                    url: url,
                    data: data,
                    dataType: "json",
                    success: function(result){
                        result = JSON.parse(result);
                        if(result.type == 'success'){
                            $centName = result.cent_name;
                            $('.jifen5_1 b').html($centName);
                            $(".jifen5").css("display", "block");
						}else{
                            layer.msg(result.msg,{icon:0,time:2000});
						}

                    }
                });

			})

            $(".button1").click(function() {
                $(".jifen5").css("display", "none");
                window.location.href="/";
            })

            function alert_choose_service(title,url,w,h){
                var index = layer.open({
                    type: 2,
                    title: title,
                    content: url
                });
                layer.full(index);
            }
		})
	</script>
	</body>

</html>